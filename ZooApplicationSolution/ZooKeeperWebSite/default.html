<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<body>
    <h1>Zoo Application | Zoo Keeper</h1>
    <div id="animals-view">
        <h2>Get Animals</h2>
        <ul id="animals-list"></ul>
        <button type="button" id="animal-add-new-button">Add New</button>
    </div>
    <div id="animal-form-view">
        <h2>Animal Form</h2>
        <form id="animal-form">
            <input type="hidden" id="animal-form-id" />
            <label for="animal-form-name">Name</label>
            <input id="animal-form-name" name="animal-form-name" type="text" />
            <label for="animal-form-date-of-birth">Date of Birth</label>
            <input id="animal-form-date-of-birth" name="animal-form-date-of-birth" type="date" />
            <button type="button" id="animal-form-save-button">Save</button>
            <button type="button" id="animal-form-delete-button">Delete</button>
        </form>
    </div>
    <h3>Get Animal</h3>
    <div id="get-animal">
    </div>
    <h3>Post Animal</h3>
    <div id="post-animal">
    </div>
    <h3>Put Animal</h3>
    <div id="put-animal">
    </div>
    <h3>Delete Animal</h3>
    <div id="delete-animal">
    </div>
    <script type="text/javascript">
        var baseAddress = "http://localhost:59255/";

        function getAnimalCallBack(responseText) {
           
            document.getElementById("animal-form").reset();

            var animalModel = JSON.parse(responseText);
            document.getElementById("animal-form-id").value = animalModel.Id;
            document.getElementById("animal-form-name").value = animalModel.Name;
            document.getElementById("animal-form-date-of-birth").value = animalModel.DateOfBirth;

            document.getElementById("animal-form-save-button").setAttribute("onclick", "putAnimal(putAnimalCallBack); return false;");
            document.getElementById("animal-form-view").style.visibility = 'visible';
            document.getElementById("animal-form-delete-button").style.visibility = 'visible';
        }

        function postAnimalCallBack(responseText) {
            document.getElementById("post-animal").innerHTML = responseText;
        }

        function putAnimalCallBack(responseText) {
            getAnimals(getAnimalsCallBack);
            document.getElementById("put-animal").innerHTML = responseText;
        }

        function deleteAnimalCallBack(responseText) {
            document.getElementById("delete-animal").innerHTML = responseText;
        }

        function getAnimalsCallBack(responseText) {

            var animalModels = JSON.parse(responseText);
            var animalsList = document.getElementById("animals-list");
            animalsList.innerHTML = "";

            for (var i = 0; i < animalModels.length; i++) {
                var animalModel = animalModels[i];

                var link = document.createElement("a");
                var linkText = document.createTextNode(animalModel.Name);
                link.appendChild(linkText);
                link.setAttribute("onclick", "getAnimal('" + animalModel.Id + "', getAnimalCallBack); return false;");
                link.href = "#";

                var li = document.createElement("li");
                li.appendChild(link);
                animalsList.appendChild(li);
            }
        }

        function sendGetRequest(url) {
            var request = new XMLHttpRequest();
            request.open("GET", url, false);
            request.send();

            return request.responseText;
        }

        function sendJsonOnRequest(type, url, json, callBack)
        {
            var request = new XMLHttpRequest();
            request.open(type, url)
            request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            request.onload = function () {
                if (request.status === 200) {
                    callBack(request.responseText);
                }
            };

            request.send(json);
        }

        function getAnimal(id, callBack) {
            var url = baseAddress + "api/Animal/" + id;
            var responseText = sendGetRequest(url);
            callBack(responseText);
        }

        function postAnimal(callBack) {
            var type = "POST";
            var url = baseAddress + "api/Animal/";

            var animalName = document.getElementById("animal-form-name").value;
            var animalDateOfBirth = document.getElementById("animal-form-date-of-birth").value;
            var json = JSON.stringify({ name: animalName, dateofbirth: animalDateOfBirth });

            sendJsonOnRequest(type, url, json, callBack);
        }

        function putAnimal(callBack) {
            var type = "PUT";
            var animalId = document.getElementById("animal-form-id").value;
            var url = baseAddress + "api/Animal/" + animalId;

            var animalName = document.getElementById("animal-form-name").value;
            var animalDateOfBirth = document.getElementById("animal-form-date-of-birth").value;
            var json = JSON.stringify({ name: animalName, dateofbirth: animalDateOfBirth });

            sendJsonOnRequest(type, url, json, callBack);
        }

        function deleteAnimal(id, callBack) {
            var request = new XMLHttpRequest();
            request.open("DELETE", baseAddress + "api/Animal/" + id, false);
            request.send();

            callBack(request.responseText);
        }

        function getAnimals(callBack) {
            var url = baseAddress + "api/Animals/";
            var responseText = sendGetRequest(url);
            callBack(responseText);
        }

        function animalAddNewButtonOnClick()
        {
            document.getElementById("animal-form").reset();
            document.getElementById("animal-form-view").style.visibility = 'visible';

            document.getElementById("animal-form-delete-button").style.visibility = 'hidden';
        }

        postAnimal(postAnimalCallBack);

        //var animalId = "d4b14895-d1a1-4c6d-ab29-84bc992aed1f";

        //getAnimal(animalId, getAnimalCallBack);

        //putAnimal(animalId, putAnimalCallBack);

        //getAnimal(animalId, getAnimalCallBack);

        //deleteAnimal(animalId, deleteAnimalCallBack);

        getAnimals(getAnimalsCallBack);

        var animalAddNewButton = document.getElementById("animal-add-new-button");
        animalAddNewButton.addEventListener("click", animalAddNewButtonOnClick)


    </script>
    <style type="text/css">
        #animal-form-view {
            visibility: hidden;
        }
    </style>
</body>
</html>
